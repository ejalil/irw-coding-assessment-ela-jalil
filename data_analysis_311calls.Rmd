---
title: "Data Analysis 311 calls"
author: "Ela Jalil"
date: "2026-01-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1: Data acquisition and cleaning

Load libraries

```{r}
library(tidyverse)
library(janitor)
library(dplyr)
library(DT)
library(lubridate)
library(tidyr)
library(leaflet)
library(sf)
library(ggplot2)

```

Import 311 data sets from 2015-2024, standardize titles, and initial cleaning of data

```{r}
call_2015<- read.csv("data/All_Service_Requests_-_2015.csv") %>% 
  clean_names()
call_2016 <- read.csv("data/All_Service_Requests_-_2016.csv") %>% 
  clean_names()
call_2017 <- read.csv("data/311_City_Service_Requests_in_2017.csv") %>% 
  clean_names()
call_2018 <-read.csv("data/311_City_Service_Requests_in_2018.csv") %>% 
  clean_names()
call_2019 <- read.csv("data/311_City_Service_Requests_in_2019.csv") %>% 
  clean_names()
call_2020<- read.csv("data/All_Service_Requests_-_2020.csv") %>% 
  clean_names()
call_2021 <- read.csv("data/311_City_Service_Requests_in_2021.csv") %>% 
  clean_names()
call_2022 <- read.csv("data/311_City_Service_Requests_in_2022.csv") %>% 
  clean_names()
call_2023 <- read.csv("data/All_Service_Requests_-_2023.csv") %>% 
  clean_names()
call_2024 <- read.csv("data/All_Service_Requests_-_2024.csv") %>% 
  clean_names()
```

Figure out what columns are necessary to keep

```{r}
head(call_2015)
```

Get rid of repetitive information within the data

```{r}
#adddate and serviceorderdate are the same, along with x and x coordinate etc. I will also get rid of city and state, because we know where the data is coming from. I am also getting rid of the rows created, edited and se_anno_cad_data, and object ID because it is not included in the original meta data. I also got rid of rows with NA values. 

clean_2015 <- select(call_2015, -c(1, 2,5,6,14,20,22,30,31,32,33))
#repeat this process for all data sets with adjustments

clean_2016 <- select(call_2016, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33))
clean_2017 <- select(call_2017, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2018 <- select(call_2018, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2019 <- select(call_2019, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2020 <- select(call_2020, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2021 <- select(call_2021, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2022 <- select(call_2022, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2023 <- select(call_2023, -c(1, 2,5,6,14,18,19,20,22,30,31,32,33,34))
clean_2024 <- select(call_2024, -c(1, 2,5,6,14,18,20,21,22,30,31,32,33,34))
```

## Part 2: Exploring

Now that I have 10 cleaned data sets, I will first explore the 2024 data set, and then see if the trends carry through the data

```{r}
nrow(clean_2024)
#There were 422,321 calls in 2024. This will be compared with the other years in a bar chart.
nrow(clean_2023)
#There were 423,243 calls in 2023.
nrow(clean_2022)
#There were 386,740 calls in 2022. 
nrow(clean_2021)
#There were 360,827 calls in 2021. 
nrow(clean_2020)
#There were 305,561 calls in 2020.
nrow(clean_2019)
#There were 367,099 calls in 2019
nrow(clean_2018)
#There were 338,832 calls in 2018.
nrow(clean_2017)
#There were 311,521 calls in 2017.
nrow(clean_2016)
#There were 304,474 calls in 2016.
nrow(clean_2015)
#There were 298,414 calls in 2015. 
#2023 had the most 311 calls over the past 10 years. 
#422321-298414=123,907
#There was over a 100,000 call difference between 2024 and 2015. Initial question: have more problems popped up over the years, or do more people utilize the service now?


```

Finding the most common zip codes that are calling 311 calls in 2024.

```{r}
clean_2024 %>% 
  group_by(zipcode) %>% 
  count() %>% 
  arrange(desc(n))
#Zipcodes 20002 (6,0096 calls), 20011(46,137 calls), 20001 (33,959 calls), 20019 (33,188 calls) and 20003 (27,582 calls) had the highest concentration of 311 calls in 2024. I would like to see how closely located these zipcodes are, and what the poverty/population breakdown of those areas are. 

```

Finding the most common complaint in 2024.

```{r}
#Used this to create an index of what each service code actually means
unique_codes <- unique(clean_2024[, c("servicecode", "servicecodedescription")])

clean_2024 %>% 
  group_by(servicecode) %>% 
  count() %>% 
  arrange(desc(n))
#The most common 311 calls in 2024 were S0031 - Bulk Collection (67,090 calls), S0261 - Parking Enforcement (57,304 calls), S0477 - Scheduled Yard Waste (31,672 calls), S0441 - Trash Collection Missed (20,635 calls), and S0311 - Resident Parking Permit (16,883 calls). 
```

Finding what department was called the most often in 2024

```{r}
clean_2024 %>% 
  group_by(organizationacronym) %>% 
  count() %>% 
  arrange(desc(n))
#The organizations that recieved the most 311 calls in 2024 were the Department of Public Works (309,963 calls), District Department of Transportation (63,634 calls), Department of Health (17,260 calls), Office of Unified Communications (16,872 calls) and The Department of Motor Vehicles (6,053 calls). 
#Question: Do certain departments get increased funding to address 311 calls? 
```

After looking into 2024 data, I want to narrow the scope of my investigation. I will now be focusing on the five zip codes that had the highest concentration of calls in 2024.

I first want to see if the five zip codes remained consistent over the past decade.

```{r}
zip_2024 <-clean_2024 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2024)
zip_2023 <-clean_2023 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>% 
  mutate(year = 2023)
zip_2022 <-clean_2022 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>% 
  mutate(year = 2022)
zip_2021 <-clean_2021 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>% 
  mutate(year = 2021)
zip_2020 <-clean_2020 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2020)
zip_2019 <-clean_2019 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2019)
zip_2018 <-clean_2018 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2018)
zip_2017 <-clean_2017 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2017)
zip_2016 <-clean_2016 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2016)
zip_2015<-clean_2015 %>%
  count(zipcode, sort = TRUE) %>%
  slice_max(n, n = 5)%>%
  mutate(year = 2015)
#Combine all of the data sets together 
zip_long <- bind_rows(
  zip_2015, zip_2016, zip_2017, zip_2018, zip_2019,
  zip_2020, zip_2021, zip_2022, zip_2023, zip_2024
)
#Arrange the data like I want to
zip_wide <- zip_long %>%
  pivot_wider(
    names_from = year,
    values_from = n,
    values_fill = 0
  )
#There have been seven zip codes that have been called consistently over the past 10 years: 20002, 20001, 20011, 20019,20009,20032 and 20003. These zip codes:20002, 20001, 20011, 20019 were found in the top five zip codes for the past 10 years. Zip code 20003 has emerged as a part of the top five since 2023. Zip code 20002 had the highest amount of calls across all 10 years. 
```

I will now explore what type of calls are occurring in zip code 20002.

```{r}
zip_20002_2024 <- clean_2024 %>% 
  filter(zipcode=="20002") %>% 
  group_by(servicecodedescription) %>% 
  count() %>% 
  arrange(desc(n))
#Bulk Collection (97482), Parking Enforcement (84413), Scheduled Yard Waste (52514), Illegal Dumping (36495), Residential Parking Permit Violation (3456) were the five highest services requested in 2024. 

#I want to see if there are any repeated streets 
clean_2024 %>% 
filter(zipcode=="20002") %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#There were five streets in 2024 that were called in complaints more than 100 times, with 130 M Street NE calling in a complaint 197 times within the zipcode 20002.

#I now want to see if this is the street that had the most complaints overall
all_street24 <-clean_2024 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#2720 MARTIN LUTHER KING JR AVENUE SE made the most 311 calls in 2024, with 12297 calls. 
```

I want to see what type of complaints that this street made, and if they are repeated over the years.

```{r}
street_2024 <-clean_2024 %>% 
  filter(streetaddress=="130 M STREET NE") %>% 
  group_by(servicecodedescription) %>% 
  count() %>% 
  arrange(desc(n))
#The majority of the complaints centered around parking enforcement. 
#I will now see over the past three years if this street has made it to the top of the complaints.
all_street23 <-clean_2023 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#In 2023, 2720 Martin Luther King Jr Avenue SE made the most 311 calls, with 14,156 calls. 
all_street22 <-clean_2022 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))

```

I now want to shift focus to the street that got the most 311 calls overall.

```{r}
#In 2022, 2720 Martin Luther King Jr Ave SE made the most 311 calls, with 6914 calls. 
all_street21 <-clean_2021 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#In 2021, 2720 Martin Luther King Jr Ave SE made the most 311 calls with 11917 calls. 
#I will also look back 10 years from 2024 to see if this pattern continued previously.
all_street15 <-clean_2015 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#That street was in the top six most called. 
#I want to see how long this street has been number one
all_street20 <-clean_2020 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#The same street had the most 311 calls - 11,381.
all_street19 <-clean_2019 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#Same street had the most 311 calls - 5,980. 
all_street18 <-clean_2018 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#Was ranked 11 of most 311 calls. 
all_street17 <-clean_2017 %>% 
  group_by(streetaddress) %>% 
  count() %>% 
  arrange(desc(n))
#Had the second highest number of calls - 749. 
```

I want to see what type of complaints that are being made on this street.

```{r}
mlk2024 <- clean_2024 %>% 
  filter(streetaddress == "2720 MARTIN LUTHER KING JR AVENUE SE") %>% 
  count(servicecodedescription, sort = TRUE) %>% 
  slice_max(n, n = 8)

 
#Highest 311 call is DC Government Information, 12,048. 
clean_2023 %>% 
  filter(streetaddress=="2720 MARTIN LUTHER KING JR AVENUE SE") %>% 
  group_by(servicecodedescription) %>% 
  count() %>% 
  arrange(desc(n))
#Highest 311 call is DC Government Information, 13,931. 

#Question: why is this the most common service being asked for in this area?
```

## Part 3: Visualizations

I decided to group by ward so that it made a clear visualization on data wrapper.

```{r}
data_wrapper2 <- clean_2024 %>% 
  group_by(ward) %>% 
  count()
#Export this for data wrapper
write.csv(data_wrapper2,"~/Downloads/data_wrapper2.csv", row.names = FALSE)

```

Making a bar chart in R to represent the most common

```{r}
ggplot(mlk2024, aes(x = reorder(servicecodedescription, n), y = n)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  scale_y_log10(labels = scales::comma) +
  labs(
    title = "Top 311 Call Types For 2720 Martin Luther King Jr Ave SE",
    subtitle = "The y-axis is log-scaled to account for skewed call data ",
    y = "Number of calls (log scale)",
    x = "Service type"
  ) +
  theme_minimal(base_size = 12)

p <- last_plot() +
  theme(
    plot.background  = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )

ggsave(
  filename = "311_calls_by_service.png",
  plot = p,
  width = 8,
  height = 6,
  dpi = 300,
  bg = "white"
)
```

#make a zip code map where each different 311 call is a different color and can have a hover graph when clicked, If I can't figure this out in R I definitely can in Flourish.

#I tried to combine all of the rows together and it did not work

#University areas
